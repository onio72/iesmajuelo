<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misi√≥n Sat√©lites: Niveles de Dificultad</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- MathJax Configuration -->
    <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        packages: {'[+]': ['color']}
      },
      svg: {
        fontCache: 'global'
      },
      startup: {
        typeset: false
      }
    };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
        }
        .math-display {
            overflow-x: auto;
            overflow-y: hidden;
            padding: 0.5rem 0;
        }
        .option-btn {
            transition: all 0.2s;
        }
        .option-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        @keyframes levelUpSlide {
            0% { transform: translateY(-50px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        .level-modal {
            animation: levelUpSlide 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen flex flex-col items-center p-4">

    <!-- Header -->
    <header class="w-full max-w-3xl flex justify-between items-center mb-6 bg-white p-5 rounded-xl shadow-sm border-t-4 border-blue-600">
        <div>
            <h1 class="text-2xl font-bold text-blue-900 tracking-tight">F√≠sica de Sat√©lites</h1>
            <p class="text-sm text-blue-500 font-mono font-bold" id="level-indicator">NIVEL 1: CADETE</p>
        </div>
        <div class="text-right">
            <div class="text-xs font-bold uppercase tracking-wider text-slate-400">Calificaci√≥n</div>
            <div id="score-container" class="text-4xl font-bold text-slate-300 transition-colors duration-300">
                <span id="score-display">0</span><span class="text-lg text-slate-400">/10</span>
            </div>
        </div>
    </header>

    <!-- Game Area -->
    <main id="app" class="w-full max-w-3xl space-y-6 relative">
        
        <!-- Notificaci√≥n de Nivel -->
        <div id="level-modal" class="hidden absolute inset-0 z-50 flex items-center justify-center pointer-events-none">
            <div class="level-modal bg-blue-600 text-white px-8 py-6 rounded-2xl shadow-2xl border-2 border-blue-400 text-center pointer-events-auto">
                <div class="text-4xl mb-2">üõ∞Ô∏è</div>
                <h3 class="text-2xl font-black italic uppercase tracking-wider mb-1" id="level-title">¬°√ìRBITA ALCANZADA!</h3>
                <p class="text-blue-100" id="level-desc">Iniciando maniobras orbitales complejas.</p>
                <button onclick="game.closeLevelModal()" class="mt-4 bg-white text-blue-700 px-6 py-2 rounded-full font-bold hover:bg-blue-50 transition">CONTINUAR</button>
            </div>
        </div>

        <!-- Pantalla de Victoria -->
        <div id="victory-screen" class="hidden bg-white border border-blue-200 rounded-xl p-10 text-center shadow-lg">
            <div class="text-6xl mb-4">üåç</div>
            <h2 class="text-3xl font-bold text-blue-800 mb-3">¬°Misi√≥n Orbital Completada!</h2>
            <p class="text-slate-600 mb-8 text-lg">Has demostrado un dominio total de la mec√°nica celeste.</p>
            <p class="text-2xl font-bold text-slate-800 mb-8">Nota Final: <span id="final-score" class="text-blue-600"></span> / 10</p>
            <button onclick="game.resetGame()" class="bg-blue-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-blue-700 transition shadow-lg transform hover:-translate-y-1 uppercase tracking-wide">Nueva Misi√≥n</button>
        </div>

        <!-- Tarjeta de Pregunta -->
        <div id="question-card" class="bg-white rounded-xl shadow-md overflow-hidden border border-slate-200">
            <div class="p-8">
                <div class="mb-6 flex items-center justify-between border-b border-slate-100 pb-4">
                    <span id="topic-tag" class="px-3 py-1 bg-blue-100 text-blue-700 text-xs font-bold uppercase rounded-full tracking-wide">√ìrbitas</span>
                    <span id="difficulty-tag" class="text-xs text-slate-500 italic">Variaci√≥n de 1 variable</span>
                </div>
                
                <div id="question-container">
                    <p id="question-text" class="text-xl text-slate-800 font-medium leading-loose">
                        <!-- Inyectado por JS -->
                    </p>
                </div>

                <div id="options-container" class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-8">
                    <!-- Botones inyectados por JS -->
                </div>
            </div>
        </div>

        <!-- Tarjeta de Explicaci√≥n -->
        <div id="explanation-card" class="hidden bg-white rounded-xl shadow-md border-l-4 border-amber-400 p-6 mt-4">
            <h3 class="text-amber-600 font-bold uppercase text-sm mb-4 tracking-wide">Telemetr√≠a de Misi√≥n</h3>
            <div id="explanation-content" class="text-sm space-y-5 text-slate-700 math-display leading-relaxed">
                <!-- LaTeX inyectado aqu√≠ -->
            </div>
            <div class="mt-8 text-right">
                <button onclick="game.nextQuestion()" class="bg-slate-800 text-white px-6 py-2 rounded-lg font-semibold hover:bg-slate-700 shadow-md transition">Siguiente Parametro &rarr;</button>
            </div>
        </div>

    </main>

    <footer class="mt-12 text-center text-slate-400 text-sm pb-6">
        &copy; 2024 F√≠sica Interactiva.
    </footer>

    <!-- L√≥gica del Juego -->
    <script>
        // --- Utilidades Matem√°ticas ---
        const FRACTIONS = {
            0.0625: "\\frac{1}{16}", 0.111: "\\frac{1}{9}", 0.125: "\\frac{1}{8}", 
            0.25: "\\frac{1}{4}", 0.333: "\\frac{1}{3}", 0.5: "\\frac{1}{2}", 
            0.75: "\\frac{3}{4}", 1.5: "\\frac{3}{2}",
            1: "1", 2: "2", 3: "3", 4: "4", 5: "5", 6: "6", 8: "8", 9: "9", 
            16: "16", 27: "27", 64: "64"
        };

        const getLatexFrac = (val) => {
            if (Math.abs(Math.round(val) - val) < 0.001) return Math.round(val).toString();
            for (let k in FRACTIONS) {
                if (Math.abs(val - parseFloat(k)) < 0.001) return FRACTIONS[k];
            }
            // Ra√≠ces
            let sq = val * val; 
            if (Math.abs(Math.round(sq) - sq) < 0.001) {
                let r = Math.round(sq);
                if (r > 1 && r < 100) return `\\sqrt{${r}}`;
            }
            // Inversa Ra√≠z
            let invSq = 1 / (val * val);
            if (Math.abs(Math.round(invSq) - invSq) < 0.001) {
                let r = Math.round(invSq);
                if (r > 1) return `\\frac{1}{\\sqrt{${r}}}`;
            }
            // Fracciones generadas
            for (let den = 2; den <= 50; den++) {
                let num = Math.round(val * den);
                if (Math.abs(val - num/den) < 0.001) return `\\frac{${num}}{${den}}`;
            }
            return val.toFixed(2);
        };

        const FACTORS = [2, 3, 4, 0.5, 0.25];
        const NICE_NUMBERS = [0.25, 0.5, 2, 4, 8, Math.sqrt(2), Math.sqrt(0.5)];

        // --- Definici√≥n de Magnitudes Sat√©lites ---

        const TEMPLATES = {
            vesc: {
                label: 'Velocidad de Escape',
                symbol: '{v_{esc}}',
                formula: 'v_{esc} = \\sqrt{\\frac{2GM}{R}}',
                vars: ['M', 'R'],
                dep: { M: 0.5, R: -0.5 }, // Exponentes para c√°lculos
                textGen: (c) => {
                    const M_txt = getChangeText(c.M, "la masa del planeta", "f");
                    const R_txt = getChangeText(c.R, "el radio del planeta", "m");
                    return `La velocidad de escape desde la superficie de un planeta de masa $M$ y radio $R$ es $v_{esc}$. Determine la velocidad de escape desde la superficie de otro planeta donde ${M_txt} y ${R_txt}.`;
                }
            },
            vorb: {
                label: 'Velocidad Orbital',
                symbol: '{v_{orb}}',
                formula: 'v_{orb} = \\sqrt{\\frac{GM}{r}}',
                vars: ['M', 'r'],
                dep: { M: 0.5, r: -0.5 },
                textGen: (c) => {
                    const M_txt = getChangeText(c.M, "la masa del planeta", "f");
                    const r_txt = getChangeText(c.r, "el radio de la √≥rbita", "m");
                    return `Un sat√©lite describe una √≥rbita circular de radio $r$ alrededor de un planeta de masa $M$ con velocidad $v_{orb}$. ¬øCu√°l ser√≠a su velocidad orbital en un sistema donde ${M_txt} y ${r_txt}?`;
                }
            },
            T: {
                label: 'Periodo Orbital',
                symbol: 'T',
                formula: 'T = 2\\pi\\sqrt{\\frac{r^3}{GM}}',
                vars: ['M', 'r'],
                dep: { r: 1.5, M: -0.5 },
                textGen: (c) => {
                    const M_txt = getChangeText(c.M, "la masa central", "f");
                    const r_txt = getChangeText(c.r, "el radio de la √≥rbita", "m");
                    return `El periodo de un sat√©lite en una √≥rbita de radio $r$ alrededor de una masa $M$ es $T$. Calcule el periodo de un sat√©lite en un sistema donde ${r_txt} y ${M_txt}.`;
                }
            },
            Ec: {
                label: 'Energ√≠a Cin√©tica',
                symbol: '{E_c}',
                formula: 'E_c = \\frac{GMm}{2r}',
                vars: ['M', 'm', 'r'],
                dep: { M: 1, m: 1, r: -1 },
                textGen: (c) => {
                    const satTxt = getChangeText(c.m, "la masa del sat√©lite", "f");
                    const plaTxt = getChangeText(c.M, "la masa del planeta", "f");
                    const radTxt = getChangeText(c.r, "el radio de √≥rbita", "m");
                    return `Un sat√©lite de masa $m$ orbita alrededor de un planeta de masa $M$ con un radio de √≥rbita $r$. Su energ√≠a cin√©tica vale $E_c$. ¬øCu√°nto vale la energ√≠a cin√©tica en una situaci√≥n donde ${satTxt}, ${plaTxt} y ${radTxt}?`;
                }
            },
            Ep: {
                label: 'Energ√≠a Potencial',
                symbol: '{E_p}',
                formula: 'E_p = -\\frac{GMm}{r}',
                vars: ['M', 'm', 'r'],
                dep: { M: 1, m: 1, r: -1 },
                textGen: (c) => {
                    const satTxt = getChangeText(c.m, "la masa del sat√©lite", "f");
                    const plaTxt = getChangeText(c.M, "la masa del planeta", "f");
                    const radTxt = getChangeText(c.r, "el radio de √≥rbita", "m");
                    return `La energ√≠a potencial gravitatoria del sistema es $E_p$. Determine el valor de dicha energ√≠a para una situaci√≥n donde ${satTxt}, ${plaTxt} y ${radTxt}.`;
                }
            },
            Em: {
                label: 'Energ√≠a Mec√°nica',
                symbol: '{E_m}',
                formula: 'E_m = -\\frac{GMm}{2r}',
                vars: ['M', 'm', 'r'],
                dep: { M: 1, m: 1, r: -1 },
                textGen: (c) => {
                    const satTxt = getChangeText(c.m, "la masa del sat√©lite", "f");
                    const plaTxt = getChangeText(c.M, "la masa del planeta", "f");
                    const radTxt = getChangeText(c.r, "el radio de √≥rbita", "m");
                    return `La energ√≠a mec√°nica total de un sat√©lite en √≥rbita es $E_m$. Compare su valor con una situaci√≥n donde ${satTxt}, ${plaTxt} y ${radTxt}.`;
                }
            }
        };

        function getChangeText(val, name, gender) {
            if (val === 1) return `${name} se mantiene constante`;
            let action = "";
            if (val === 2) action = "se duplica";
            else if (val === 3) action = "se triplica";
            else if (val === 4) action = "se cuadruplica";
            else if (Math.abs(val - 0.5) < 0.001) action = "se reduce a la mitad";
            else if (Math.abs(val - 0.25) < 0.001) action = "se reduce a la cuarta parte";
            else action = `se multiplica por ${getLatexFrac(val)}`;
            return `${name} ${action}`;
        }

        // --- Motor del Juego ---

        class PhysicsGame {
            constructor() {
                this.score = 0;
                this.deck = []; 
                this.currentCard = null;
                this.isProcessing = false;
                this.currentLevel = 0;
                
                this.initDeck();
                setTimeout(() => {
                    this.showLevelModal(1, "ENTRENAMIENTO B√ÅSICO", "Domina los cambios de una sola variable.");
                    this.nextQuestion();
                }, 500);
            }

            initDeck() {
                let allCards = [];
                const magKeys = Object.keys(TEMPLATES);

                magKeys.forEach(key => {
                    const t = TEMPLATES[key];
                    const nVars = t.vars.length;
                    const maxComb = Math.pow(2, nVars) - 1;

                    for(let i=1; i<=maxComb; i++) {
                        let difficulty = 0;
                        let mask = i;
                        while(mask > 0) {
                            if(mask & 1) difficulty++;
                            mask >>= 1;
                        }
                        allCards.push({ mag: key, mask: i, difficulty: difficulty });
                    }
                });

                let level1 = allCards.filter(c => c.difficulty === 1);
                let level2 = allCards.filter(c => c.difficulty === 2);
                let level3 = allCards.filter(c => c.difficulty === 3);

                const shuffle = (arr) => arr.sort(() => Math.random() - 0.5);
                shuffle(level1); shuffle(level2); shuffle(level3);

                this.deck = [...level3, ...level2, ...level1];
            }

            updateScoreDisplay() {
                const display = document.getElementById('score-display');
                display.innerText = this.score;
                const container = document.getElementById('score-container');
                container.classList.remove('text-red-500', 'text-yellow-500', 'text-emerald-500', 'text-slate-300');
                if (this.score < 5) container.classList.add('text-red-500');
                else if (this.score < 7) container.classList.add('text-yellow-500');
                else container.classList.add('text-emerald-500');
            }

            showLevelModal(level, title, desc) {
                const modal = document.getElementById('level-modal');
                document.getElementById('level-title').innerText = title;
                document.getElementById('level-desc').innerText = desc;
                modal.classList.remove('hidden');
                let role = level === 1 ? "CADETE" : (level === 2 ? "PILOTO" : "COMANDANTE");
                document.getElementById('level-indicator').innerText = `NIVEL ${level}: ${role}`;
                this.currentLevel = level;
            }

            closeLevelModal() {
                document.getElementById('level-modal').classList.add('hidden');
            }

            nextQuestion() {
                if (this.deck.length === 0) {
                    this.showVictory();
                    return;
                }

                this.isProcessing = false;
                document.getElementById('explanation-card').classList.add('hidden');
                document.getElementById('victory-screen').classList.add('hidden');
                document.getElementById('question-card').classList.remove('hidden');

                const nextCardPreview = this.deck[this.deck.length - 1];
                if (nextCardPreview.difficulty > this.currentLevel) {
                    if (nextCardPreview.difficulty === 2) this.showLevelModal(2, "FASE 2: PILOTO", "Atenci√≥n: Dos variables cambian simult√°neamente.");
                    else if (nextCardPreview.difficulty === 3) this.showLevelModal(3, "FASE FINAL: COMANDANTE", "M√°xima complejidad. Tres variables alteradas.");
                    this.currentLevel = nextCardPreview.difficulty;
                }

                const card = this.deck.pop();
                const template = TEMPLATES[card.mag];
                
                let changes = {}; 
                let varsChangingCount = 0;

                template.vars.forEach((v, index) => {
                    const isChanging = (card.mask & (1 << index)) !== 0;
                    if (isChanging) {
                        changes[v] = FACTORS[Math.floor(Math.random() * FACTORS.length)];
                        varsChangingCount++;
                    } else {
                        changes[v] = 1;
                    }
                });

                let resultFactor = 1;
                template.vars.forEach(v => {
                    const exp = template.dep[v];
                    const val = changes[v];
                    resultFactor *= Math.pow(val, exp);
                });

                this.currentCard = { template, changes, resultFactor, difficulty: varsChangingCount };
                this.render();
            }

            async render() {
                const c = this.currentCard;
                document.getElementById('topic-tag').innerText = c.template.label;
                const diffText = c.difficulty === 1 ? "Variaci√≥n de 1 variable" : `Variaci√≥n de ${c.difficulty} variables`;
                document.getElementById('difficulty-tag').innerText = diffText;
                this.updateScoreDisplay();

                document.getElementById('question-text').innerHTML = c.template.textGen(c.changes);
                this.renderOptions(c.resultFactor);

                if (window.MathJax) {
                    await MathJax.typesetPromise([document.getElementById('question-text'), document.getElementById('options-container')]);
                }
            }

            renderOptions(correctVal) {
                const container = document.getElementById('options-container');
                container.innerHTML = '';
                let optionsMap = new Map();
                const addOption = (val) => {
                    if (!Number.isFinite(val) || val <= 0.001 || isNaN(val)) return;
                    const latex = getLatexFrac(val);
                    if (!optionsMap.has(latex)) optionsMap.set(latex, { val: val, latex: latex });
                };

                addOption(correctVal);
                if (correctVal !== 0) addOption(1/correctVal);
                addOption(Math.pow(correctVal, 2));
                addOption(Math.sqrt(correctVal));
                addOption(correctVal * 2);
                addOption(correctVal / 2);

                let shuffledNice = [...NICE_NUMBERS].sort(() => 0.5 - Math.random());
                for (let num of shuffledNice) { if (optionsMap.size >= 4) break; addOption(num); }
                let backup = 1;
                while (optionsMap.size < 4) { addOption(backup++); }

                let finalOpts = Array.from(optionsMap.values()).sort((a, b) => a.val - b.val);
                const correctLatex = getLatexFrac(correctVal);
                let correctIndex = finalOpts.findIndex(o => o.latex === correctLatex);
                let selectedOptions = [];
                if (finalOpts.length <= 4) selectedOptions = finalOpts;
                else {
                    let start = Math.max(0, correctIndex - 1);
                    if (start + 4 > finalOpts.length) start = finalOpts.length - 4;
                    start = Math.max(0, start);
                    selectedOptions = finalOpts.slice(start, start + 4);
                }

                selectedOptions.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = "option-btn w-full p-6 text-left border rounded-lg bg-white hover:bg-blue-50 hover:border-blue-300 font-medium text-slate-700 border-slate-200 shadow-sm group flex justify-center items-center";
                    const sym = this.currentCard.template.symbol;
                    let formula = opt.val === 1 ? `$ { ${sym} }_2 = { ${sym} }_1 $` : `$ { ${sym} }_2 = ${opt.latex} \\cdot { ${sym} }_1 $`;
                    btn.innerHTML = `<span class="text-xl font-serif">${formula}</span>`;
                    btn.onclick = () => this.checkAnswer(opt.val, btn);
                    container.appendChild(btn);
                });
            }

            checkAnswer(val, btn) {
                if (this.isProcessing) return;
                this.isProcessing = true;
                const correct = this.currentCard.resultFactor;
                const isCorrect = Math.abs(val - correct) < 0.001;

                document.querySelectorAll('.option-btn').forEach(b => {
                    b.disabled = true;
                    b.classList.add('opacity-50', 'cursor-not-allowed');
                });
                btn.classList.remove('opacity-50', 'bg-white');

                if (isCorrect) {
                    this.score = Math.min(10, this.score + 0.5);
                    btn.classList.add('bg-blue-100', 'border-blue-500', 'text-blue-900');
                    btn.innerHTML += `<span class="ml-2 text-blue-600 text-xl">‚úì</span>`;
                } else {
                    this.score = Math.max(0, this.score - 0.25);
                    btn.classList.add('bg-red-100', 'border-red-500', 'text-red-900');
                    btn.innerHTML += `<span class="ml-2 text-red-600 text-xl">‚úó</span>`;
                }
                this.updateScoreDisplay();
                this.showExplanation();
            }

            async showExplanation() {
                const c = this.currentCard;
                const changes = c.changes;
                const sym = c.template.symbol;
                
                // Construcci√≥n de la f√≥rmula de sustituci√≥n
                let subNumParts = [];
                let subDenParts = [];
                let factorNumParts = [];
                let factorDenParts = [];

                c.template.vars.forEach(v => {
                    const exp = c.template.dep[v]; // Puede ser 0.5, 1, 1.5, -1...
                    const val = changes[v];
                    const latexVal = getLatexFrac(val);
                    
                    // L√≥gica para visualizaci√≥n de potencias/ra√≠ces
                    let termDisplay = v;
                    if (val !== 1) termDisplay = `(${latexVal}${v})`;
                    
                    let numFactor = (val !== 1) ? latexVal : "";

                    // Aplicar formato de ra√≠z o potencia
                    const applyFormat = (base, exponent) => {
                        const absExp = Math.abs(exponent);
                        if (absExp === 0.5) return `\\sqrt{${base}}`;
                        if (absExp === 1.5) return `\\sqrt{(${base})^3}`;
                        if (absExp !== 1) return `${base}^${absExp}`;
                        return base;
                    };

                    let finalTerm = applyFormat(termDisplay, exp);
                    let finalFactor = numFactor ? applyFormat(numFactor, exp) : "";

                    if (exp > 0) {
                        subNumParts.push(finalTerm);
                        if (finalFactor) factorNumParts.push(finalFactor);
                    } else {
                        subDenParts.push(finalTerm);
                        if (finalFactor) factorDenParts.push(finalFactor);
                    }
                });

                // Ensamblar
                let constPrefix = c.template.formula.includes("-") ? "-" : "";
                if(c.template.formula.includes("2\\pi")) constPrefix += "2\\pi";
                // Limpieza de constantes: F√≥rmulas base
                // Si la f√≥rmula base tiene raiz, la constante G suele estar dentro.
                // Para simplificar la visualizaci√≥n de la sustituci√≥n, asumimos estructura de fracci√≥n simple o ra√≠z.
                
                // Reconstrucci√≥n visual aproximada para la explicaci√≥n
                const subNumTex = subNumParts.join(" \\cdot ");
                const subDenTex = subDenParts.length > 0 ? subDenParts.join(" ") : "1";
                
                let substEq = "";
                // Detectar si la f√≥rmula original es una ra√≠z grande (v_esc, v_orb, T)
                if (c.template.formula.includes("\\sqrt")) {
                     // Caso especial ra√≠ces: Metemos todo bajo una ra√≠z gigante visual
                     // O simplemente mostramos la fracci√≥n factorizada.
                     // Estrategia simple: Mostrar factores extra√≠dos.
                     substEq = `\\text{Sustituimos valores en } ${c.template.formula}`;
                } else {
                     substEq = `{ ${sym} }_2 = ${constPrefix} \\frac{${subNumTex}}{${subDenTex}}`;
                }

                // Factores num√©ricos
                const factorNumTex = factorNumParts.length > 0 ? factorNumParts.join("\\cdot ") : "1";
                const factorDenTex = factorDenParts.length > 0 ? factorDenParts.join("\\cdot ") : "1";
                
                let extractionEq = "";
                if (factorDenTex === "1") extractionEq = factorNumTex;
                else extractionEq = `\\frac{${factorNumTex}}{${factorDenTex}}`;

                const resultStr = getLatexFrac(c.resultFactor);
                let finalEq = (Math.abs(c.resultFactor - 1) < 0.001) ? `{ ${sym} }_2 = { ${sym} }_1` : `{ ${sym} }_2 = ${resultStr} \\cdot { ${sym} }_1`;

                const html = `
                    <p class="font-bold text-blue-700">1. F√≥rmula base</p>
                    <p class="ml-4 mb-4">$$ ${c.template.formula} $$</p>
                    <p class="font-bold text-blue-700">2. Proporci√≥n</p>
                    <p class="ml-4 mb-4">Extraemos los factores de cambio (las constantes $G, M, R...$ se cancelan al dividir):
                    $$ \\frac{ {${sym}}_2 }{ {${sym}}_1 } = ${extractionEq} $$</p>
                    <p class="font-bold text-blue-700">3. Resultado final</p>
                    <p class="ml-4">
                    $$ { ${sym} }_2 = ${resultStr} \\cdot { ${sym} }_1 $$</p>
                `;

                const expContent = document.getElementById('explanation-content');
                expContent.innerHTML = html;
                document.getElementById('explanation-card').classList.remove('hidden');
                if (window.MathJax) await MathJax.typesetPromise([expContent]);
                expContent.scrollIntoView({behavior: "smooth"});
            }

            resetGame() {
                this.score = 0;
                this.initDeck();
                this.currentLevel = 0;
                this.showLevelModal(1, "ENTRENAMIENTO B√ÅSICO", "Domina los cambios de una sola variable.");
                this.nextQuestion();
            }

            showVictory() {
                document.getElementById('question-card').classList.add('hidden');
                document.getElementById('explanation-card').classList.add('hidden');
                document.getElementById('victory-screen').classList.remove('hidden');
                const final = document.getElementById('final-score');
                final.innerText = this.score;
                final.className = "text-2xl font-bold mb-8 " + (this.score < 5 ? "text-red-600" : (this.score < 7 ? "text-yellow-600" : "text-emerald-600"));
            }
        }

        const game = new PhysicsGame();
    </script>
</body>
</html>
